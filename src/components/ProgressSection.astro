---
import type { Correlativity } from '@/types/correlativity';
import getMotivationalPhrase from '@/utils/getMotivationalPhrase';

interface Props {
  subjects: Correlativity[];
}

const { subjects } = Astro.props;

const totalSubjects = subjects.length;
const approvedSubjects = subjects.filter((subject) => subject.isPassed).length;
const percentageApproved =
  totalSubjects > 0 ? (approvedSubjects / totalSubjects) * 100 : 0;

const totalPlanHours = subjects.reduce((total, subject) => total + subject.hours, 0);
const completedHours = subjects.reduce(
  (total, subject) => (subject.isPassed ? total + subject.hours : total),
  0
);
const pendingHours = Math.max(totalPlanHours - completedHours, 0);

const motivationalPhrase = getMotivationalPhrase(percentageApproved);
---

<section
  class="p-4 rounded-lg shadow bg-white dark:bg-zinc-900 text-fixed space-y-4"
>
  <p class="text-xl text-center font-bold">Progreso Universitario</p>

  <p class="text-center text-xs">
    <span data-progress-percentage>
      {percentageApproved.toFixed(1)}
    </span>
    % del plan completado
  </p>

  <div class="charge-bar bg-gray-200 dark:bg-zinc-800">
    <div
      class="charge-bar-progress bg-black dark:bg-white"
      data-progress-bar
      style={{ width: `${percentageApproved}%` }}
    />
  </div>

  <p class="text-sm text-center" data-motivational>
    {motivationalPhrase}
  </p>

  <div class="mt-2 flex flex-wrap gap-4 justify-center text-sm md:text-base">
    <p class="text-lg font-semibold">
      Horas cursadas:
      <span
        class="font-bold text-blue-600 dark:text-blue-400"
        data-hours-completed
      >
        {completedHours}
      </span>
    </p>

    <p class="text-lg font-semibold">
      Horas restantes:
      <span
        class="font-bold text-blue-600 dark:text-blue-400"
        data-hours-missing
      >
        {pendingHours}
      </span>
    </p>
  </div>
</section>

<style>
  .charge-bar {
    height: 20px;
    border-radius: 10px;
    width: 100%;
    overflow: hidden;
  }

  .charge-bar-progress {
    height: 100%;
    transition: width 0.3s ease-in-out;
  }
</style>
