---
import type { Correlativity } from '@/types/correlativity';
import getMotivationalPhrase from '@/utils/getMotivationalPhrase';

interface Props {
  subjects: Correlativity[];
}

const { subjects } = Astro.props;

const totalSubjects = subjects.length;
const approvedSubjects = subjects.filter((subject) => subject.isPassed).length;
const percentageApproved =
  totalSubjects > 0 ? (approvedSubjects / totalSubjects) * 100 : 0;

const totalPlanHours = subjects.reduce((total, subject) => total + subject.hours, 0);
const completedHours = subjects.reduce(
  (total, subject) => (subject.isPassed ? total + subject.hours : total),
  0
);
const pendingHours = Math.max(totalPlanHours - completedHours, 0);

const motivationalPhrase = getMotivationalPhrase(percentageApproved);
---

<section
  class="p-4 rounded-lg shadow-md space-y-4 progress-section overflow-hidden"
>
  <p class="text-xl text-center font-bold progress-title">Progreso Universitario</p>

  <p class="text-center text-xs progress-subtitle">
    <span data-progress-percentage class="font-semibold progress-value">
      {percentageApproved.toFixed(1)}
    </span>
    % del plan completado
  </p>

  <div class="charge-bar">
    <div
      class="charge-bar-progress"
      data-progress-bar
      style={{ width: `${percentageApproved}%` }}
    />
  </div>

  <p class="text-sm text-center progress-subtitle" data-motivational>
    {motivationalPhrase}
  </p>

  <div class="mt-2 flex flex-wrap gap-4 justify-center text-sm md:text-base">
    <p class="text-lg font-semibold progress-title">
      Horas cursadas:
      <span class="font-bold progress-accent" data-hours-completed>
        {completedHours}
      </span>
    </p>

    <p class="text-lg font-semibold progress-title">
      Horas restantes:
      <span class="font-bold progress-accent" data-hours-missing>
        {pendingHours}
      </span>
    </p>
  </div>
</section>

<style>
  /* Light mode (default) */
  .progress-section {
    background-color: #f5f3e8;
  }
  .progress-title {
    color: #231b42;
  }
  .progress-subtitle {
    color: #4a3f6b;
  }
  .progress-value {
    color: #231b42;
  }
  .progress-accent {
    color: #f97992;
  }
  .charge-bar {
    height: 20px;
    border-radius: 10px;
    width: 100%;
    overflow: hidden;
    background-color: #c6d8c0;
  }
  .charge-bar-progress {
    height: 100%;
    transition: width 0.3s ease-in-out;
    background-color: #f97992;
  }

  /* Dark mode */
  :global(.dark) .progress-section {
    background-color: #1f1f1f;
  }
  :global(.dark) .progress-title {
    color: #e6e1cd;
  }
  :global(.dark) .progress-subtitle {
    color: #c6d8c0;
  }
  :global(.dark) .progress-value {
    color: #e6e1cd;
  }
  :global(.dark) .charge-bar {
    background-color: #4a3f6b;
  }
</style>
